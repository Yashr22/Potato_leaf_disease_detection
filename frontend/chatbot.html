<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Potato Leaf Disease Detection + FAQ Chatbot</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(to right, #e0f7fa, #f9f9f9);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 40px 20px;
        color: #333;
        min-height: 100vh;
      }

      h2,
      h3 {
        color: #1e3a8a;
        margin-bottom: 10px;
      }

      input[type="file"] {
        margin: 12px 0;
        padding: 8px;
        background-color: #fff;
        border: 2px dashed #94a3b8;
        border-radius: 6px;
        width: 100%;
        max-width: 300px;
        cursor: pointer;
      }

      button {
        background: #2563eb;
        color: #fff;
        padding: 10px 18px;
        margin: 6px 4px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      button:hover {
        background: #1e40af;
        transform: scale(1.03);
      }

      #preview {
        margin: 16px 0;
        max-width: 300px;
        max-height: 300px;
        border: 3px solid #cbd5e1;
        border-radius: 10px;
        display: none;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      #result {
        font-size: 18px;
        margin-top: 15px;
        color: #1f2937;
        white-space: pre-line;
        background: #dbeafe;
        padding: 12px 18px;
        border-radius: 10px;
        border-left: 5px solid #2563eb;
        max-width: 600px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.07);
      }

      /* Chatbot styles */
      #chat-container {
        width: 100%;
        max-width: 680px;
        margin-top: 60px;
        background: #ffffff;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      }

      #chatbox {
        height: 300px;
        overflow-y: auto;
        border: 2px solid #cbd5e1;
        padding: 12px;
        background: #f1f5f9;
        border-radius: 10px;
        margin-bottom: 12px;
        font-size: 15px;
      }

      .user {
        font-weight: bold;
        color: #1e293b;
      }

      .bot {
        color: #2563eb;
        margin-left: 10px;
      }

      #controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        margin-bottom: 10px;
      }

      #userInput,
      #langSelect {
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        flex: 1;
        font-size: 15px;
      }

      #faq-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
        margin-top: 12px;
      }

      #faq-buttons button {
        background-color: #f3f4f6;
        color: #111827;
        padding: 8px 12px;
        font-size: 14px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        transition: background 0.3s ease;
      }

      #faq-buttons button:hover {
        background-color: #e0e7ff;
        color: #1d4ed8;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h2>üß™ Potato Leaf Disease Detection</h2>
    <input
      type="file"
      id="fileInput"
      accept="image/*"
      onchange="previewImage(event)"
    />
    <img id="preview" />
    <button onclick="predict()">üîç Predict</button>
    <p id="result"></p>

    <div id="chat-container">
      <h3>üåæ Kisan Chatbot</h3>
      <select id="langSelect">
        <option value="en">English</option>
        <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
        <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
      </select>

      <div id="chatbox"></div>

      <div id="controls">
        <input id="userInput" placeholder="Type your question here..." />
        <button id="sendBtn" onclick="sendMessage()">Send</button>
        <button id="voiceBtn" onclick="startListening()">üé§ Speak</button>
      </div>

      <div id="faq-buttons">
        <p><strong>Quick FAQs:</strong></p>
        <button onclick="askFAQ('early_blight')">Early Blight</button>
        <button onclick="askFAQ('late_blight')">Late Blight</button>
        <button onclick="askFAQ('bacterial_wilt')">Bacterial Wilt</button>
        <button onclick="askFAQ('potato_scab')">Potato Scab</button>
        <button onclick="askFAQ('blackleg')">Blackleg</button>
        <button onclick="askFAQ('fusarium_wilt')">Fusarium Wilt</button>
        <button onclick="askFAQ('powdery_mildew')">Powdery Mildew</button>
        <button onclick="askFAQ('downy_mildew')">Downy Mildew</button>
        <button onclick="askFAQ('aphid_infestation')">Aphid Infestation</button>
        <button onclick="askFAQ('nematode_damage')">Nematode Damage</button>
        <br />
        <button onclick="askFAQ('pm_kisan')">PM‚ÄëKISAN</button>
        <button onclick="askFAQ('kcc')">KCC Loan</button>
        <button onclick="askFAQ('crop_insurance')">Crop Insurance</button>
        <button onclick="askFAQ('agri_loan')">Agri Loan</button>
        <button onclick="askFAQ('microfinance')">Microfinance</button>
        <button onclick="askFAQ('subsidy')">Subsidies</button>
        <button onclick="askFAQ('soil_health_card')">Soil Health Card</button>
        <button onclick="askFAQ('drip_irrigation')">Drip Subsidy</button>
        <button onclick="askFAQ('cold_storage')">Cold Storage</button>
        <button onclick="askFAQ('warehouse_receipts')">
          Warehouse Financing
        </button>
      </div>
    </div>

    <script>
      // Image Preview & Prediction
      function previewImage(e) {
        const p = document.getElementById("preview");
        p.src = URL.createObjectURL(e.target.files[0]);
        p.style.display = "block";
      }
      async function predict() {
        const file = document.getElementById("fileInput").files[0];
        if (!file) {
          return (document.getElementById("result").innerText =
            "Please select a file.");
        }
        document.getElementById("result").innerText = "Processing...";
        const fd = new FormData();
        fd.append("file", file);
        try {
          const res = await fetch("http://localhost:8001/predict", {
            method: "POST",
            body: fd,
          });
          const data = await res.json();
          if (data.error) {
            document.getElementById(
              "result"
            ).innerText = `Error: ${data.error}`;
          } else {
            document.getElementById("result").innerText = `Prediction: ${
              data.class
            }\nConfidence: ${(data.confidence * 100).toFixed(2)}%`;
            showDiseaseAdvice(data.class);
          }
        } catch (err) {
          console.error(err);
          document.getElementById("result").innerText = "Prediction failed.";
        }
      }

      // FAQ Data
      const faq = {
        en: {
          default: "Sorry, I didn't understand. Ask about diseases or finance.",
          early_blight:
            "Early Blight: Caused by Alternaria solani. Treat with Mancozeb. Loss: Up to 30%.",
          late_blight:
            "Late Blight: Phytophthora infestans. Use Metalaxyl; remove leaves. Loss: total crop in weeks.",
          bacterial_wilt:
            "Bacterial Wilt: Ralstonia solanacearum. Avoid waterlogging; remove plants. Loss: 20‚Äì25%.",
          potato_scab:
            "Potato Scab: Streptomyces scabies. Use certified seed; pH 5.2‚Äì5.5. Loss: 10‚Äì15%.",
          blackleg:
            "Blackleg: Pectobacterium atrosepticum. Seed treatment. Loss: 15‚Äì20%.",
          fusarium_wilt:
            "Fusarium Wilt: Fusarium spp. Rotate crops; resistant varieties. Loss: ~25%.",
          powdery_mildew:
            "Powdery Mildew: Erysiphe spp. Sulfur spray. Loss: 10‚Äì20%.",
          downy_mildew:
            "Downy Mildew: Phytophthora infestans. Copper spray. Loss: 20‚Äì30%.",
          aphid_infestation:
            "Aphid Infestation: Various aphids. Neem oil/insecticide. Loss: up to 15%.",
          nematode_damage:
            "Nematode Damage: Root‚Äëknot. Soil fumigation; resistant varieties. Loss: ~20%.",
          pm_kisan: "PM‚ÄëKISAN: ‚Çπ6,000/year. Apply at pmkisan.gov.in.",
          kcc: "KCC Loan: Low‚Äëinterest agri credit card. Bank apply.",
          crop_insurance: "PMFBY: Premium subsidy. Enroll at Bima Kendra.",
          agri_loan:
            "Agri Loan: Short‚Äëterm NABARD/co‚Äëop at concessional rates.",
          microfinance: "Microfinance: SHG/MFI small loans. Contact MFI.",
          subsidy:
            "Subsidies: Seeds/fertilizers/equipment via state agri dept.",
          soil_health_card:
            "Soil Health Card: Free soil test & advice. Register online.",
          drip_irrigation: "Drip Subsidy: 70% under MGNREGA. Register online.",
          cold_storage: "Cold Storage Subsidy: 35%. Apply via FCI/state govt.",
          warehouse_receipts:
            "Warehouse Financing: Loans against stored produce.",
        },
        hi: {
          default: "‡§Æ‡§æ‡§´ ‡§ï‡§∞‡•á‡§Ç, ‡§∏‡§Æ‡§ù ‡§®‡§π‡•Ä‡§Ç ‡§™‡§æ‡§Ø‡§æ‡•§ ‡§∞‡•ã‡§ó ‡§Ø‡§æ ‡§µ‡§ø‡§§‡•ç‡§§ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§õ‡•á‡§Ç‡•§",
          early_blight:
            "‡§Ö‡§∞‡•ç‡§≤‡•Ä ‡§¨‡•ç‡§≤‡§æ‡§á‡§ü: Alternaria solani‡•§ Mancozeb ‡§õ‡§ø‡§°‡§º‡§ï‡•á‡§Ç‡•§ ‡§®‡•Å‡§ï‡§∏‡§æ‡§®: 30% ‡§§‡§ï‡•§",
          late_blight:
            "‡§≤‡•á‡§ü ‡§¨‡•ç‡§≤‡§æ‡§á‡§ü: Phytophthora infestans‡•§ Metalaxyl ‡§≤‡§ó‡§æ‡§è‡§Ç; ‡§™‡§§‡•ç‡§§‡•á ‡§π‡§ü‡§æ‡§è‡§Ç‡•§",
          bacterial_wilt:
            "‡§¨‡•à‡§ï‡•ç‡§ü‡•Ä‡§∞‡§ø‡§Ø‡§≤ ‡§µ‡§ø‡§≤‡•ç‡§ü: Ralstonia‡•§ ‡§ú‡§≤‡§ú‡§Æ‡§æ‡§µ ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç; ‡§™‡•å‡§ß‡•á ‡§π‡§ü‡§æ‡§è‡§Ç‡•§",
          potato_scab:
            "‡§™‡•ã‡§ü‡•à‡§ü‡•ã ‡§∏‡•ç‡§ï‡•à‡§¨: Streptomyces scabies‡•§ ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§ø‡§§ ‡§¨‡§ø‡§Ø‡§æ‡§ú; pH 5.2‚Äì5.5‡•§",
          blackleg: "‡§¨‡•ç‡§≤‡•à‡§ï‡§≤‡•á‡§ó: Pectobacterium‡•§ ‡§¨‡•Ä‡§ú ‡§â‡§™‡§ö‡§æ‡§∞‡•§",
          fusarium_wilt: "‡§´‡•ç‡§Ø‡•Ç‡§ú‡§º‡•á‡§∞‡§ø‡§Ø‡§Æ ‡§µ‡§ø‡§≤‡•ç‡§Æ‡•ç: Fusarium spp. ‡§´‡§∏‡§≤ ‡§ö‡§ï‡•ç‡§∞‡•Ä‡§ï‡§∞‡§£‡•§",
          powdery_mildew: "‡§™‡§æ‡§â‡§°‡§∞‡•Ä ‡§Æ‡§ø‡§≤‡•ç‡§°‡•ç‡§Ø‡•Ç: Erysiphe spp. ‡§∏‡§≤‡•ç‡§´‡§∞ ‡§õ‡§ø‡§°‡§º‡§ï‡§æ‡§µ‡•§",
          downy_mildew: "‡§°‡§æ‡§â‡§®‡§Æ‡•Ä ‡§Æ‡§ø‡§≤‡•ç‡§°‡•ç‡§Ø‡•Ç: Phytophthora‡•§ ‡§ï‡•â‡§™‡§∞ ‡§∏‡•ç‡§™‡•ç‡§∞‡•á‡•§",
          aphid_infestation: "‡§è‡§´‡§ø‡§°: ‡§®‡•Ä‡§Æ ‡§§‡•á‡§≤/‡§ï‡•Ä‡§ü‡§®‡§æ‡§∂‡§ï‡•§",
          nematode_damage: "‡§®‡•à‡§Æ‡•á‡§ü‡•ã‡§°: ‡§Æ‡•É‡§¶‡§æ ‡§®‡§∏‡§¨‡§Ç‡§¶‡•Ä; ‡§™‡•ç‡§∞‡§§‡§ø‡§∞‡•ã‡§ß‡•Ä‡•§",
          pm_kisan: "‡§™‡•Ä‡§è‡§Æ-‡§ï‡§ø‡§∏‡§æ‡§®: ‚Çπ6,000/‡§µ‡§∞‡•ç‡§∑‡•§ pmkisan.gov.in ‡§™‡§∞‡•§",
          kcc: "‡§ï‡§ø‡§∏‡§æ‡§® ‡§ï‡•ç‡§∞‡•á‡§°‡§ø‡§ü ‡§ï‡§æ‡§∞‡•ç‡§°: ‡§¨‡•à‡§Ç‡§ï ‡§Æ‡•á‡§Ç ‡§Ü‡§µ‡•á‡§¶‡§®‡•§",
          crop_insurance: "‡§´‡§∏‡§≤ ‡§¨‡•Ä‡§Æ‡§æ (PMFBY): ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ ‡§∏‡§¨‡•ç‡§∏‡§ø‡§°‡•Ä‡•§",
          agri_loan: "‡§ï‡•É‡§∑‡§ø ‡§ã‡§£: NABARD/‡§∏‡§π‡§ï‡§æ‡§∞‡•Ä‡•§",
          microfinance: "‡§Æ‡§æ‡§á‡§ï‡•ç‡§∞‡•ã‡§´‡§æ‡§Ø‡§®‡•á‡§Ç‡§∏: SHG/MFI‡•§",
          subsidy: "‡§∏‡§¨‡•ç‡§∏‡§ø‡§°‡•Ä: ‡§¨‡•Ä‡§ú/‡§â‡§∞‡•ç‡§µ‡§∞‡§ï ‡§™‡§∞‡•§",
          soil_health_card: "‡§Æ‡•É‡§¶‡§æ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ï‡§æ‡§∞‡•ç‡§°: ‡§®‡§ø:‡§∂‡•Å‡§≤‡•ç‡§ï‡•§",
          drip_irrigation: "‡§°‡•ç‡§∞‡§ø‡§™ ‡§∏‡§¨‡•ç‡§∏‡§ø‡§°‡•Ä: 70% MGNREGA‡•§",
          cold_storage: "‡§ï‡•ã‡§≤‡•ç‡§° ‡§∏‡•ç‡§ü‡•ã‡§∞‡•á‡§ú: 35%‡•§",
          warehouse_receipts: "‡§ó‡•ã‡§¶‡§æ‡§Æ ‡§µ‡§ø‡§§‡•ç‡§§ ‡§™‡•ã‡§∑‡§£: ‡§≠‡§Ç‡§°‡§æ‡§∞ ‡§ã‡§£‡•§",
        },
        kn: {
          default: "‡≤ï‡≥ç‡≤∑‡≤Æ‡≤ø‡≤∏‡≤ø, ‡≤Ö‡≤∞‡≥ç‡≤•‡≤µ‡≤æ‡≤ó‡≤≤‡≤ø‡≤≤‡≥ç‡≤≤. ‡≤∞‡≥ã‡≤ó ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤Ü‡≤∞‡≥ç‡≤•‡≤ø‡≤ï ‡≤µ‡≤ø‡≤ö‡≤æ‡≤∞ ‡≤ï‡≥á‡≤≥‡≤ø.",
          early_blight:
            "‡≤Ö‡≤ï‡≤æ‡≤≤‡≤ø‡≤ï ‡≤¨‡≥ç‡≤≤‡≥à‡≤ü‡≥ç: Alternaria solani. ‡≤Æ‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ã‡≤ú‡≥Ü‡≤¨‡≥ç ‡≤π‡≤ö‡≥ç‡≤ö‡≤ø. ‡≤®‡≤∑‡≥ç‡≤ü: 30%.",
          late_blight:
            "‡≤µ‡≤ø‡≤≤‡≤Ç‡≤¨‡≤ø‡≤§ ‡≤¨‡≥ç‡≤≤‡≥à‡≤ü‡≥ç: Phytophthora infestans. ‡≤Æ‡≥Ü‡≤ü‡≤æ‡≤≤‡≤æ‡≤ï‡≥ç‡≤∏‡≤ø‡≤≤‡≥ç, ‡≤é‡≤≤‡≥Ü ‡≤§‡≥Ü‡≤ó‡≥Ü‡≤Ø‡≤ø‡≤∞‡≤ø.",
          bacterial_wilt:
            "‡≤¨‡≥ç‡≤Ø‡≤æ‡≤ï‡≥ç‡≤ü‡≥Ä‡≤∞‡≤ø‡≤Ø‡≤≤‡≥ç ‡≤µ‡≤ø‡≤≤‡≥ç‡≤ü‡≥ç: Ralstonia. ‡≤®‡≥Ä‡≤∞‡≥Å ‡≤§‡≤™‡≥ç‡≤™‡≤ø‡≤∏‡≤ø; ‡≤∏‡≤∏‡≥ç‡≤Ø ‡≤§‡≥Ü‡≤ó‡≥Ü‡≤Ø‡≤ø‡≤∞‡≤ø.",
          potato_scab:
            "‡≤™‡≥ä‡≤ü‡≥á‡≤ü‡≥ä ‡≤∏‡≥ç‡≤ï‡≥ç‡≤Ø‡≤æ‡≤¨‡≥ç: Streptomyces scabies. ‡≤™‡≥ç‡≤∞‡≤Æ‡≤æ‡≤£‡≤ø‡≤§ ‡≤¨‡≥Ä‡≤ú; pH 5.2‚Äì5.5.",
          blackleg: "‡≤¨‡≥ç‡≤≤‡≥ç‡≤Ø‡≤æ‡≤ï‡≥ç‚Äå‡≤≤‡≥Ü‡≤ó‡≥ç: Pectobacterium. ‡≤¨‡≥Ä‡≤ú ‡≤ö‡≤ø‡≤ï‡≤ø‡≤§‡≥ç‡≤∏‡≥Ü.",
          fusarium_wilt: "‡≤´‡≥ç‡≤Ø‡≥Ç‡≤ú‡≥á‡≤∞‡≤ø‡≤Ø‡≤Ç ‡≤µ‡≤ø‡≤≤‡≥ç‡≤ü‡≥ç: Fusarium spp. ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤ö‡≤ï‡≥ç‡≤∞.",
          powdery_mildew: "‡≤™‡≥å‡≤°‡≤∞‡≤ø ‡≤Æ‡≤ø‡≤≤‡≥ç‡≤°‡≥ç‡≤Ø‡≥Ç: Erysiphe spp. ‡≤ó‡≤Ç‡≤ß‡≤ï.",
          downy_mildew: "‡≤°‡≥å‡≤®‡≤ø ‡≤Æ‡≤ø‡≤≤‡≥ç‡≤°‡≥ç‡≤Ø‡≥Ç: Phytophthora. ‡≤ï‡≤æ‡≤™‡≤∞‡≥ç ‡≤∏‡≤ø‡≤Ç‡≤™‡≤°‡≤ø‡≤∏‡≤ø.",
          aphid_infestation: "‡≤é‡≤´‡≤ø‡≤°‡≥ç: ‡≤®‡≥Ä‡≤Ç ‡≤é‡≤£‡≥ç‡≤£‡≥Ü/‡≤ï‡≥Ä‡≤ü‡≤®‡≤æ‡≤∂‡≤ï.",
          nematode_damage: "‡≤®‡≤Æ‡≥ä‡≤ü‡≥ã‡≤°‡≥ç: ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å ‡≤´‡≥ç‡≤Ø‡≥Ç‡≤Æ‡≤ø‡≤ó‡≥á‡≤∂‡≤®‡≥ç.",
          pm_kisan: "PM‚ÄëKISAN: ‚Çπ6,000/‡≤µ‡≤∞‡≥ç‡≤∑. pmkisan.gov.in.",
          kcc: "KCC ‡≤∏‡≤æ‡≤≤: ‡≤¨‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ç ‡≤Ö‡≤∞‡≥ç‡≤ú‡≤ø.",
          crop_insurance: "PMFBY ‡≤µ‡≤ø‡≤Æ‡≥Ü: ‡≤™‡≥ç‡≤∞‡≥Ä‡≤Æ‡≤ø‡≤Ø‡≤Ç ‡≤∏‡≤¨‡≥ç‡≤∏‡≤ø‡≤°‡≤ø.",
          agri_loan: "‡≤ï‡≥É‡≤∑‡≤ø ‡≤∏‡≤æ‡≤≤: NABARD/‡≤∏‡≤π‡≤ï‡≤æ‡≤∞‡≤ø.",
          microfinance: "‡≤Æ‡≥à‡≤ï‡≥ç‡≤∞‡≥ä‡≤´‡≥à‡≤®‡≤æ‡≤®‡≥ç‡≤∏‡≥ç: SHG/MFI.",
          subsidy: "‡≤∏‡≤¨‡≥ç‡≤∏‡≤ø‡≤°‡≤ø: ‡≤¨‡≥Ä‡≤ú/‡≤ä‡≤∞‡≥ç‡≤µ‡≤∞‡≤ï.",
          soil_health_card: "Soil Health Card: ‡≤â‡≤ö‡≤ø‡≤§.",
          drip_irrigation: "‡≤°‡≥ç‡≤∞‡≤ø‡≤™‡≥ç: 70% MGNREGA.",
          cold_storage: "‡≤ï‡≥ã‡≤≤‡≥ç‡≤°‡≥ç ‡≤∏‡≥ç‡≤ü‡≥ã‡≤∞‡≥á‡≤ú‡≥ç: 35%.",
          warehouse_receipts: "‡≤ï‡≥ã‡≤¶‡≤æ‡≤Æ‡≥Å ‡≤ß‡≤®‡≤ï‡≥ã‡≤∂.",
        },
        bn: {
          default: "‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶¨‡ßÅ‡¶ù‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø‡¶®‡¶ø‡•§ ‡¶∞‡ßã‡¶ó ‡¶¨‡¶æ ‡¶Ü‡¶∞‡ßç‡¶•‡¶ø‡¶ï ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
          early_blight:
            "‡¶Ü‡¶∞‡ßç‡¶≤‡¶ø ‡¶¨‡ßç‡¶≤‡¶æ‡¶á‡¶ü: Alternaria solani‡•§ Mancozeb ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡ß©‡ß¶% ‡¶ï‡ßç‡¶∑‡¶§‡¶ø‡•§",
          late_blight:
            "‡¶≤‡ßá‡¶ü ‡¶¨‡ßç‡¶≤‡¶æ‡¶á‡¶ü: Phytophthora infestans‡•§ Metalaxyl, ‡¶™‡¶æ‡¶§‡¶æ ‡¶∏‡¶∞‡¶æ‡¶®‡•§",
          bacterial_wilt: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ü‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶â‡¶á‡¶≤‡ßç‡¶ü: Ralstonia‡•§ ‡¶ú‡¶≤‡¶æ‡¶¨‡¶¶‡ßç‡¶ß‡¶§‡¶æ ‡¶è‡¶°‡¶º‡¶æ‡¶®‡•§",
          potato_scab:
            "‡¶™‡¶ü‡ßá‡¶ü‡ßã ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶¨: Streptomyces scabies‡•§ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ü‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶¨‡ßÄ‡¶ú; pH¬†5.2‚Äì5.5‡•§",
          blackleg: "‡¶¨‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ï‡¶≤‡ßá‡¶ó: Pectobacterium‡•§ ‡¶¨‡ßÄ‡¶ú ‡¶ö‡¶ø‡¶ï‡¶ø‡ßé‡¶∏‡¶æ‡•§",
          fusarium_wilt: "‡¶´‡¶ø‡¶â‡¶ú‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶â‡¶á‡¶≤‡ßç‡¶ü: Fusarium spp. ‡¶´‡¶∏‡¶≤ ‡¶ò‡ßã‡¶∞‡¶æ‡¶®‡•§",
          powdery_mildew: "‡¶™‡¶æ‡¶â‡¶°‡¶æ‡¶∞‡¶ø ‡¶Æ‡¶ø‡¶≤‡¶°‡¶ø‡¶â: Erysiphe spp. ‡¶∏‡¶æ‡¶≤‡¶´‡¶æ‡¶∞ ‡¶∏‡ßç‡¶™‡ßç‡¶∞‡ßá‡•§",
          downy_mildew: "‡¶°‡¶æ‡¶â‡¶®‡¶ø ‡¶Æ‡¶ø‡¶≤‡¶°‡¶ø‡¶â: Phytophthora‡•§ ‡¶§‡¶æ‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßç‡¶™‡ßç‡¶∞‡ßá‡•§",
          aphid_infestation: "‡¶è‡¶´‡¶ø‡¶°: ‡¶®‡¶ø‡¶Æ ‡¶§‡ßá‡¶≤‡•§",
          nematode_damage: "‡¶®‡ßá‡¶Æ‡¶æ‡¶ü‡ßã‡¶°: ‡¶Æ‡¶æ‡¶ü‡¶ø ‡¶´‡¶ø‡¶â‡¶Æ‡¶ø‡¶ó‡ßá‡¶∂‡¶®‡•§",
          pm_kisan: "PM‚ÄëKISAN: ‚Çπ6,000/‡¶¨‡¶õ‡¶∞‡•§ pmkisan.gov.in‡•§",
          kcc: "KCC ‡¶ã‡¶£: ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡ßá ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡•§",
          crop_insurance: "PMFBY: ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶≠‡¶∞‡ßç‡¶§‡ßÅ‡¶ï‡¶ø‡•§",
          agri_loan: "‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶ã‡¶£: NABARD/‡¶∏‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ‡•§",
          microfinance: "‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏: SHG/MFI‡•§",
          subsidy: "‡¶≠‡¶∞‡ßç‡¶§‡ßÅ‡¶ï‡¶ø: ‡¶¨‡ßÄ‡¶ú/‡¶∏‡¶æ‡¶∞‡•§",
          soil_health_card: "‡¶Æ‡¶æ‡¶ü‡¶ø ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°: ‡¶¨‡¶ø‡¶®‡¶æ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø ‡¶™‡¶∞‡¶æ‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡•§",
          drip_irrigation: "‡¶°‡ßç‡¶∞‡¶ø‡¶™: ‡ß≠‡ß¶% MGNREGA‡•§",
          cold_storage: "‡¶ï‡ßã‡¶≤‡ßç‡¶° ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú: ‡ß©‡ß´%‡•§",
          warehouse_receipts: "‡¶ó‡ßÅ‡¶¶‡¶æ‡¶Æ ‡¶´‡¶æ‡¶á‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏‡•§",
        },
      };

      // Chat Helpers
      function appendMessage(who, text) {
        const box = document.getElementById("chatbox");
        const cls = who === "user" ? "user" : "bot";
        box.innerHTML += `<div><span class="${cls}">${
          who === "user" ? "You" : "Bot"
        }:</span> ${text}</div>`;
        box.scrollTop = box.scrollHeight;
        if (who === "bot") speakText(text);
      }

      function sendMessage() {
        const txtEl = document.getElementById("userInput");
        const txt = txtEl.value.trim();
        if (!txt) return;
        const lang = document.getElementById("langSelect").value;
        appendMessage("user", txt);
        let key = "default",
          low = txt.toLowerCase();
        for (const k in faq[lang]) {
          if (k !== "default" && low.includes(k.replace(/_/g, " "))) {
            key = k;
            break;
          }
        }
        appendMessage("bot", faq[lang][key]);
        txtEl.value = "";
      }

      function askFAQ(key) {
        const lang = document.getElementById("langSelect").value;
        appendMessage("user", key.replace(/_/g, " "));
        appendMessage("bot", faq[lang][key] || faq[lang].default);
      }

      function showDiseaseAdvice(d) {
        askFAQ(d.trim().toLowerCase().replace(/\s+/g, "_"));
      }

      // Voice Input
      let recognition;
      if (window.SpeechRecognition || window.webkitSpeechRecognition) {
        recognition = new (window.SpeechRecognition ||
          window.webkitSpeechRecognition)();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
        recognition.onresult = (e) => {
          const txt = e.results[0][0].transcript;
          document.getElementById("userInput").value = txt;
          sendMessage();
        };
        recognition.onerror = (e) => console.error("SpeechRec error", e);
      }

      function startListening() {
        const lang = document.getElementById("langSelect").value;
        recognition.lang =
          lang === "hi"
            ? "hi-IN"
            : lang === "kn"
            ? "kn-IN"
            : lang === "bn"
            ? "bn-IN"
            : "en-IN";
        recognition.start();
      }

      // Text-to-Speech
      function speakText(text) {
        const lang = document.getElementById("langSelect").value;
        const u = new SpeechSynthesisUtterance(text);
        u.lang =
          lang === "hi"
            ? "hi-IN"
            : lang === "kn"
            ? "kn-IN"
            : lang === "bn"
            ? "bn-IN"
            : "en-US";
        const voices = window.speechSynthesis.getVoices();
        let v =
          voices.find((x) => x.lang === u.lang) ||
          voices.find((x) => x.lang.startsWith(u.lang.split("-")[0]));
        if (v) u.voice = v;
        window.speechSynthesis.speak(u);
      }

      window.speechSynthesis.onvoiceschanged = () =>
        window.speechSynthesis.getVoices();
      // Voice Input (continued)
      recognition.onresult = (e) => {
        const txt = e.results[0][0].transcript;
        document.getElementById("userInput").value = txt;
        sendMessage();
      };
      recognition.onerror = (e) => {
        console.error("Voice recognition error:", e.error);
      };

      function startListening() {
        if (recognition) recognition.start();
      }

      // Voice Output (speech synthesis)
      function speakText(text) {
        if ("speechSynthesis" in window) {
          const utter = new SpeechSynthesisUtterance(text);
          utter.lang =
            document.getElementById("langSelect").value === "hi"
              ? "hi-IN"
              : document.getElementById("langSelect").value === "kn"
              ? "kn-IN"
              : document.getElementById("langSelect").value === "bn"
              ? "bn-IN"
              : "en-US";
          speechSynthesis.speak(utter);
        }
      }
      function speakText(text) {
        const lang = document.getElementById("langSelect").value;
        const utterance = new SpeechSynthesisUtterance(text);

        // Language-specific voices
        const langMap = {
          en: "en-IN",
          hi: "hi-IN",
          kn: "kn-IN",
          bn: "bn-IN",
        };
        utterance.lang = langMap[lang] || "en-IN";

        // Try to use a matching voice
        const voices = window.speechSynthesis.getVoices();
        const matchedVoice = voices.find((v) => v.lang === utterance.lang);
        if (matchedVoice) utterance.voice = matchedVoice;

        speechSynthesis.speak(utterance);
      }
    </script>
  </body>
</html>
